<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <!--Определяем, где находится клиентское SDK-->
    <IPSSDKDir>$(IPS_SDK_DIR)</IPSSDKDir>
    <IPSSDKDir>$(IPSSDKDir.TrimEnd($([System.IO.Path]::DirectorySeparatorChar)))\</IPSSDKDir>
    <IPSClientSDKDir>$(IPSSDKDir)Client\</IPSClientSDKDir>
    <IPSClientPluginTargetsPath>$(IPSClientSDKDir)IPSClientPlugin.props</IPSClientPluginTargetsPath>

    <!--Определяем, где находится клиент IPS. Для этого используется переменная окружения IPS_CLIENT_DIR-->
    <!--Значения свойств с окончанием Dir по традиции MSBuild должны завершаться слэшем-->
    <!--Эти свойства могут быть использованы в post build event проектов модулей расширения IPS-->
    <IPSClientDir>$(IPS_CLIENT_DIR)</IPSClientDir>
    <IPSClientDir>$(IPSClientDir.TrimEnd($([System.IO.Path]::DirectorySeparatorChar)))\</IPSClientDir>
    <IPSClientPluginsDir Condition="$(IPS_VERSION) == ''">$(IPSClientDir)</IPSClientPluginsDir>
    <IPSClientPluginsDir Condition="$(IPS_VERSION) != '' and $(IPS_VERSION) &gt;= 6">$(IPSClientDir)</IPSClientPluginsDir>

    <!--Добавим в свойство ReferencePath пути к каталогам со сборками IPS. Это необходимо для компиляции проекта и добавления ссылок на сборки -->
    <ReferencePath>$(IPSClientDir);$(IPSClientPluginsDir);$(ReferencePath)</ReferencePath>
  </PropertyGroup>

  <!--Подключаем определения и цели для клиентского модуля расширения-->
  <Import Project="$(IPSClientPluginTargetsPath)" Condition="exists('$(IPSClientPluginTargetsPath)')"/>
  <Import Project="$(IPSSDKDir)Custom\Client\IPSClientPlugin.*.props"/>
  <Import Project="$(SolutionDir).ips\IPSClientPlugin.props" Condition="'$(SolutionDir)' != '' AND Exists('$(SolutionDir).ips\IPSClientPlugin.props')"/>

  <Target Name="ValidateIPSClientSDK" BeforeTargets="PrepareForBuild">
    <Message Text="Validating the IPS SDK"/>
    <Error Condition="'$(IPS_SDK_DIR)' == ''" Text="Для компиляции проекта требуется установленное IPS SDK. Убедитесь, что IPS SDK установлено, и перезапустите Visual Studio." />
    <Error Condition="!Exists('$(IPSSDKDir)')" Text="Не удалось найти каталог '$(IPSSDKDir)'. Убедитеcь, что IPS SDK установлено корректно, и перезапустите Visual Studio." />
    <Error Condition="!Exists('$(IPSClientSDKDir)')" Text="Не удалось найти каталог '$(IPSClientSDKDir)', являющийся частью IPS SDK. Убедитеcь, что IPS SDK установлено корректно, и перезапустите Visual Studio." />
    <Error Condition="!Exists('$(IPSClientPluginTargetsPath)')" Text="Не удалось найти Файл '$(IPSClientPluginTargetsPath)', являющийся частью IPS SDK. Убедитеcь, что IPS SDK установлено корректно, и перезапустите Visual Studio." />   

    <Error Condition="'$(IPS_CLIENT_DIR)' == ''" Text="Не заполнена переменная окружения IPS_CLIENT_DIR, которая должна указывать на каталог клиента IPS. Воспользуйтесь конфигуратором IPS SDK, чтобы указать расположение клиента IPS, и перезапустите Visual Studio." />
    <Error Condition="!Exists('$(IPSClientDir)')" Text="Не удалось найти каталог '$(IPSClientDir)', на который указывает переменная окружения IPS_CLIENT_DIR. Воспользуйтесь конфигуратором IPS SDK, чтобы указать корректное расположение клиента IPS, и перезапустите Visual Studio." />
    <Error Condition="!Exists('$(IPSClientPluginsDir)')" Text="Не удалось найти каталог '$(IPSClientPluginsDir)'. Воспользуйтесь конфигуратором IPS SDK, чтобы указать корректное расположение клиента IPS, и перезапустите Visual Studio." />
  </Target>

</Project>
